<template>
  <div class="index">
    <div v-if="isDrawer" id="amap-container"></div>
    <drawer-view :is-drawer="isDrawer" title-text="哈哈哈" :body-init-height="bodyHeight" @drawerStart="drawerStart"
                 @drawerEnd="drawerEnd">
      <div style="height: 200px;background: lightblue;">1</div>
      <div style="height: 200px;background: aquamarine;">2</div>
      <div style="height: 200px;background: darkgray;">3</div>
      <div style="height: 200px;background: yellowgreen;">4</div>
    </drawer-view>
  </div>
</template>

<script>
  import util from '../../common/DMC.util'
  import DrawerView from './components/DrawerView'

  const drivingLine = require('./script/drivingLine')
  const testArr = [[121.423393, 31.211748], [121.425972, 31.210045], [121.428909, 31.210487], [121.430916, 31.212656], [121.434464, 31.214918], [121.438469, 31.217804], [121.442772, 31.219658], [121.447235, 31.221125], [121.45369, 31.223351], [121.461395, 31.223871], [121.466743, 31.223734], [121.474792, 31.226597], [121.480835, 31.2299], [121.483376, 31.230824], [121.487389, 31.230728], [121.493073, 31.233278], [121.500496, 31.238016], [121.504807, 31.236597], [121.50927, 31.236986], [121.511292, 31.235538]]

  export default {
    name: 'drivingLine',
    components: {
      DrawerView
    },
    data() {
      return {
        isDrawer: true,//是否显示抽屉
        startPos: null,//起点
        endPos: null,//终点
        currentPos: null,//途径点
        drivingPos: null,//司机坐标
        bodyHeight: 100
      }
    },
    directives: {},
    watch: {},
    methods: {
      drawerStart(f) {
        console.log('drawerStart', f)
      },
      drawerEnd(d) {
        console.log('drawerEnd', d)
      },
      initData() {
        // this.startPos = [121.423596, 31.211773]
        // this.endPos = [121.510652, 31.235425]
        // this.drivingPos = [121.423596, 31.211773]
        // this.currentPos = []
        // return
        const data = {
          "drivingPos": [
            {
              "lng": "121.51733",
              "lat": "31.338745"
            },
            {
              "lng": "121.51733",
              "lat": "31.341246"
            },
            {
              "lng": "121.51733",
              "lat": "31.342497"
            },
            {
              "lng": "121.51733",
              "lat": "31.343746"
            },
            {
              "lng": "121.51733",
              "lat": "31.344995"
            },
            {
              "lng": "121.51733",
              "lat": "31.346247"
            },
            {
              "lng": "121.51733",
              "lat": "31.347496"
            },
            {
              "lng": "121.51733",
              "lat": "31.348745"
            },
            {
              "lng": "121.51733",
              "lat": "31.349997"
            },
            {
              "lng": "121.51733",
              "lat": "31.351246"
            },
            {
              "lng": "121.51733",
              "lat": "31.352495"
            },
            {
              "lng": "121.51733",
              "lat": "31.353746"
            },
            {
              "lng": "121.51733",
              "lat": "31.354996"
            },
            {
              "lng": "121.51733",
              "lat": "31.356247"
            },
            {
              "lng": "121.51733",
              "lat": "31.357496"
            },
            {
              "lng": "121.51733",
              "lat": "31.358746"
            },
            {
              "lng": "121.51733",
              "lat": "31.359997"
            },
            {
              "lng": "121.51733",
              "lat": "31.361246"
            },
            {
              "lng": "121.51733",
              "lat": "31.362495"
            },
            {
              "lng": "121.51733",
              "lat": "31.363747"
            },
            {
              "lng": "121.51733",
              "lat": "31.364996"
            },
            {
              "lng": "121.51733",
              "lat": "31.366245"
            },
            {
              "lng": "121.51733",
              "lat": "31.367496"
            },
            {
              "lng": "121.51733",
              "lat": "31.368746"
            },
            {
              "lng": "121.51733",
              "lat": "31.369995"
            },
            {
              "lng": "121.51733",
              "lat": "31.371246"
            },
            {
              "lng": "121.51733",
              "lat": "31.372496"
            },
            {
              "lng": "121.51733",
              "lat": "31.373747"
            },
            {
              "lng": "121.51733",
              "lat": "31.374996"
            },
            {
              "lng": "121.51733",
              "lat": "31.376245"
            },
            {
              "lng": "121.51733",
              "lat": "31.377497"
            },
            {
              "lng": "121.51733",
              "lat": "31.378746"
            },
            {
              "lng": "121.51733",
              "lat": "31.379995"
            },
            {
              "lng": "121.51733",
              "lat": "31.381247"
            },
            {
              "lng": "121.51733",
              "lat": "31.382496"
            },
            {
              "lng": "121.51733",
              "lat": "31.383745"
            },
            {
              "lng": "121.51733",
              "lat": "31.384996"
            },
            {
              "lng": "121.51733",
              "lat": "31.386246"
            },
            {
              "lng": "121.51733",
              "lat": "31.387497"
            },
            {
              "lng": "121.51733",
              "lat": "31.388746"
            },
            {
              "lng": "121.51733",
              "lat": "31.389996"
            },
            {
              "lng": "121.51733",
              "lat": "31.391247"
            },
            {
              "lng": "121.51733",
              "lat": "31.392496"
            },
            {
              "lng": "121.51733",
              "lat": "31.393745"
            },
            {
              "lng": "121.51733",
              "lat": "31.394997"
            },
            {
              "lng": "121.51733",
              "lat": "31.396246"
            },
            {
              "lng": "121.51733",
              "lat": "31.397495"
            },
            {
              "lng": "121.51733",
              "lat": "31.398746"
            },
            {
              "lng": "121.51733",
              "lat": "31.399996"
            },
            {
              "lng": "121.51733",
              "lat": "31.401245"
            },
            {
              "lng": "121.51733",
              "lat": "31.402496"
            },
            {
              "lng": "121.51733",
              "lat": "31.403746"
            },
            {
              "lng": "121.51733",
              "lat": "31.404997"
            },
            {
              "lng": "121.51733",
              "lat": "31.406246"
            },
            {
              "lng": "121.51733",
              "lat": "31.407495"
            },
            {
              "lng": "121.51733",
              "lat": "31.408747"
            },
            {
              "lng": "121.51733",
              "lat": "31.409996"
            },
            {
              "lng": "121.51733",
              "lat": "31.411245"
            },
            {
              "lng": "121.51733",
              "lat": "31.412497"
            },
            {
              "lng": "121.51733",
              "lat": "31.413746"
            },
            {
              "lng": "121.51733",
              "lat": "31.414995"
            },
            {
              "lng": "121.51733",
              "lat": "31.416246"
            },
            {
              "lng": "121.51733",
              "lat": "31.417496"
            },
            {
              "lng": "121.51733",
              "lat": "31.418747"
            },
            {
              "lng": "121.51733",
              "lat": "31.419996"
            },
            {
              "lng": "121.51733",
              "lat": "31.421246"
            },
            {
              "lng": "121.51733",
              "lat": "31.422497"
            },
            {
              "lng": "121.51733",
              "lat": "31.423746"
            },
            {
              "lng": "121.51733",
              "lat": "31.424995"
            },
            {
              "lng": "121.51733",
              "lat": "31.426247"
            },
            {
              "lng": "121.51733",
              "lat": "31.427496"
            },
            {
              "lng": "121.51733",
              "lat": "31.428745"
            },
            {
              "lng": "121.51733",
              "lat": "31.429996"
            },
            {
              "lng": "121.51733",
              "lat": "31.431246"
            },
            {
              "lng": "121.51733",
              "lat": "31.432495"
            },
            {
              "lng": "121.51733",
              "lat": "31.433746"
            },
            {
              "lng": "121.51733",
              "lat": "31.434996"
            },
            {
              "lng": "121.51733",
              "lat": "31.436247"
            },
            {
              "lng": "121.51733",
              "lat": "31.438745"
            },
            {
              "lng": "121.51733",
              "lat": "31.439997"
            },
            {
              "lng": "121.51733",
              "lat": "31.441246"
            },
            {
              "lng": "121.51733",
              "lat": "31.442495"
            },
            {
              "lng": "121.51733",
              "lat": "31.443747"
            },
            {
              "lng": "121.51733",
              "lat": "31.444996"
            },
            {
              "lng": "121.51733",
              "lat": "31.446245"
            },
            {
              "lng": "121.51733",
              "lat": "31.447496"
            },
            {
              "lng": "121.51733",
              "lat": "31.448746"
            },
            {
              "lng": "121.51733",
              "lat": "31.449997"
            },
            {
              "lng": "121.51733",
              "lat": "31.451246"
            },
            {
              "lng": "121.51733",
              "lat": "31.452496"
            },
            {
              "lng": "121.51733",
              "lat": "31.453747"
            },
            {
              "lng": "121.51733",
              "lat": "31.454996"
            },
            {
              "lng": "121.51733",
              "lat": "31.456245"
            },
            {
              "lng": "121.51733",
              "lat": "31.457497"
            },
            {
              "lng": "121.51733",
              "lat": "31.458746"
            },
            {
              "lng": "121.51733",
              "lat": "31.459995"
            },
            {
              "lng": "121.51733",
              "lat": "31.461246"
            },
            {
              "lng": "121.51733",
              "lat": "31.462496"
            },
            {
              "lng": "121.51733",
              "lat": "31.463745"
            },
            {
              "lng": "121.51733",
              "lat": "31.464996"
            },
            {
              "lng": "121.51733",
              "lat": "31.466246"
            },
            {
              "lng": "121.51733",
              "lat": "31.467497"
            },
            {
              "lng": "121.51733",
              "lat": "31.468746"
            },
            {
              "lng": "121.51733",
              "lat": "31.469995"
            },
            {
              "lng": "121.51733",
              "lat": "31.471247"
            },
            {
              "lng": "121.51733",
              "lat": "31.472496"
            },
            {
              "lng": "121.51733",
              "lat": "31.473745"
            },
            {
              "lng": "121.51733",
              "lat": "31.474997"
            },
            {
              "lng": "121.51733",
              "lat": "31.476246"
            },
            {
              "lng": "121.51733",
              "lat": "31.477495"
            },
            {
              "lng": "121.51733",
              "lat": "31.478746"
            },
            {
              "lng": "121.51733",
              "lat": "31.479996"
            },
            {
              "lng": "121.51733",
              "lat": "31.481247"
            },
            {
              "lng": "121.51733",
              "lat": "31.482496"
            },
            {
              "lng": "121.51733",
              "lat": "31.483746"
            },
            {
              "lng": "121.51733",
              "lat": "31.484997"
            },
            {
              "lng": "121.51733",
              "lat": "31.486246"
            },
            {
              "lng": "121.51733",
              "lat": "31.487495"
            },
            {
              "lng": "121.51733",
              "lat": "31.488747"
            },
            {
              "lng": "121.51733",
              "lat": "31.489996"
            },
            {
              "lng": "121.51733",
              "lat": "31.491245"
            },
            {
              "lng": "121.51733",
              "lat": "31.492496"
            },
            {
              "lng": "121.51733",
              "lat": "31.493746"
            },
            {
              "lng": "121.51733",
              "lat": "31.494995"
            },
            {
              "lng": "121.51733",
              "lat": "31.496246"
            },
            {
              "lng": "121.51733",
              "lat": "31.497496"
            },
            {
              "lng": "121.51733",
              "lat": "31.498747"
            },
            {
              "lng": "121.51733",
              "lat": "31.499996"
            },
            {
              "lng": "121.51733",
              "lat": "31.501245"
            },
            {
              "lng": "121.51733",
              "lat": "31.502497"
            },
            {
              "lng": "121.51733",
              "lat": "31.503746"
            },
            {
              "lng": "121.51733",
              "lat": "31.504995"
            }
          ],
          "currentPos": {
            "lng": "121.51733",
            "lat": "31.504995"
          },
          "startPos": {
            "lng": "121.51733",
            "lat": "31.338745"
          },
          "endPos": {
            "lng": "121.442947",
            "lat": "31.216125"
          }
        }
        this.startPos = [data.startPos.lng, data.startPos.lat]
        this.endPos = [data.endPos.lng, data.endPos.lat]
        this.drivingPos = [data.currentPos.lng, data.currentPos.lat]
        this.currentPos = data.drivingPos.map(item => {
          const {lng, lat} = item
          return [lng, lat]
        })
      },
      //初始化地图
      initAmap() {
        drivingLine.initMap(() => {
          // drivingLine.testCreateLine()
          this.initData()
          drivingLine.createLine(this.startPos, this.endPos, [...this.currentPos], this.drivingPos)
        })
      },
    },
    beforeMount() {
      $(document).attr('title', '地图选址')
    },
    mounted() {
      window.app = this
      this.initAmap()
      //
      const from = this.$route.query.from
      console.log('来自', from)
      // if (util.isIPhoneX()){
      //   console.log('是iPhoneX')
      //   this.bodyHeight = 150
      // }
    }
  }
</script>

<style lang="sass" type="text/scss" rel="stylesheet/scss" scoped>
  .index {
    width: 100%;
    height: 100%;
  }

  #amap-container {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
</style>
